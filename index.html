<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="user-scalable=0" />
<title>AssemblyScript Aggregations Test</title>
<link rel="icon" href="https://assemblyscript.org/favicon.ico" type="image/x-icon" />
</head>
<body>
<script src="https://unpkg.com/as-bind@0.3.5/dist/as-bind.iife.js"></script>
<script>"use strict";

const { AsBind } = AsBindIIFE;

// Compute the size of and instantiate the module's memory
var memory = new WebAssembly.Memory({ initial: 10 });

var ints = new Int16Array(16 * 1000000);
for (var i = 0; i < ints.length; i++) {
  ints[i] = i;
}

function sum(arr) {
  var sum = 0;
  for (var i = 0; i < arr.length; i++) {
    sum += arr[i];
  }
  return sum;
}

// Fetch and instantiate the module
fetch("build/optimized.wasm")
.then(response => response.arrayBuffer())
.then(async module => {
  // as-bind includes helpers for working with higher level data structures like TypedArrays
  const asBindInstance = await AsBind.instantiate(module);
  var exports = asBindInstance.exports;
  console.time("WASM");
  var resultWASM = exports.sum(ints);
  console.timeEnd("WASM");
  console.log("resultWASM", resultWASM);
  console.time("JS");
  var resultJS = sum(ints);
  console.timeEnd("JS");
  console.log("resultJS", resultJS);
}).catch(err => {
  console.log("Failed to load WASM: ", err.message);
  console.log(err.stack);
});
</script>
Check console for results
</body>
</html>
